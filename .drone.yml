build:
  test:
    image: golang:1.8.1-alpine
    environment:
      ENV: CI
    commands:
      - echo "this is a go app  "
    when:
      event:
        - push

publish:
  gcr:
    context: nginx
    debug: true
    file: nginx/Dockerfile
    registry: us.gcr.io
    repo: inspiring-cat-165403/nginx
    tag:
      - latest
      - $$COMMIT
    token: >
      $$GOOGLE_CREDENTIALS
    when:
      event: push
deploy:
  gke:
    image: inspiring-cat-165403/nginx:$$COMMIT

    zone: us-east1-c
    cluster: gtd-util
    namespace: $$BRANCH
    token: >
      $$GOOGLE_CREDENTIALS

    vars:
      image: gcr.io/my-gke-project/my-app:$$COMMIT
      app: my-app
      env: dev
    when:
      event: push
